- # CLash_of_Clans
  # 期末项目 - 部落冲突（Clash of Clans）Cocos2d-x 复刻版
  ## 小组信息
  - 成员1：陶芷安（学号：2451307）
  - 成员2：郑涵月（学号：2451312）
  - 成员3：王婧雯（学号：2450984）
    
  ## 小组分工
  | 成员   | 贡献度 | 核心工作内容                                                 |
  | ------ | ------ | ------------------------------------------------------------ |
  | 陶芷安 | 33.3%  | 主游戏界面功能的实现，建筑相关基础功能实现，进阶地图功能的实现，场景音乐，PVP模式相关功能实现，整体项目优化 |
  | 郑涵月 | 33.3%  | 商店购买界面的实现，资源类建筑的实现，本地存档功能的实现，游戏限制设计，PVP模式测试优化，整体项目优化 |
  | 王婧雯 | 33.3%  | 五种士兵攻击寻找目标、攻击等相关功能的实现，地图系统基本功能的实现，PVP模式相关功能实现，整体项目优化 |

  ## 项目简介
  本项目基于**C++语言**和**Cocos2d-x引擎**，复刻经典策略手游《部落冲突》的核心玩法，是期末课程设计的实践成果。项目聚焦“场景建造、兵种攻防、资源管理、PVP战斗”几大核心模块，通过Cocos2d-x引擎中的功能，实现了轻量化但完整的游戏体验，同时深入实践C++面向对象设计、游戏引擎逻辑开发等技术要点。

  ## 技术栈
  - 开发语言：主要为**C++**，辅以Python实现服务器
  - 游戏引擎：Cocos2d-x 4.0
  - 依赖库：STL标准库、Cocos2d-x内置组件（如UI系统、物理引擎）
  - 工具链：Visual Studio 2022
  - 辅助软件： Tiled 1.11.2

  ## 界面设计
  - 本游戏中的主界面及四个关卡的地图均使用Tiled地图绘制软件制作。

  ## 核心功能实现
  ### 1. 村庄建设系统
  - 实现建筑体系：金币、圣水生产建筑与收集器、箭塔、加农炮、城墙、军营、大本营等核心建筑，支持拖拽布局与建筑碰撞检测。
  - 建筑升级机制：通过C++多态设计，不同建筑继承自`Building`基类，其升级以及属性由BuildinginfoLayer中设置的弹窗实现。
  - 购买建筑：游戏中存在商店，可以用对应的资源购买炮塔、金矿、圣水收集器等各类建筑。每种建筑的购买存在一定的等级限制。

  ### 2. 军队训练
  - 兵种系统：包含野蛮人、弓箭手、巨人（高血量）、炸弹人（同归于尽式攻击）等基础兵种，在游戏进入到第三关时还引入了天空兵种。通过`Soldier`基类派生，实现不同攻击逻辑与动画表现。
    
  ### 3. 资源
  - 资源管理：金币、圣水双资源体系，通过`Resource`派生类实现生产、消耗、存储的统一管理。同时也派生出宝石类用于加速管理

  ### 4.作战地图与对战逻辑
  - 地图设计：地图由Tiled软件进行绘制，第一二关较为基础，在第三关引入栅栏保护村庄，第四关引入炸弹系统。且士兵投放的区域有一定限制。
  - 对战逻辑：基于Cocos2d-x的场景切换与事件回调，实现兵种路径寻路、建筑伤害计算等核心机制，玩家只需选择并投放一定数量的兵种，士兵自动开始寻找目标进行攻击。建筑的攻击属性及生命属性根据不同建筑的特性分别在地图中或代码中进行设置。关卡之间有优先级的限制，必须先通过前一关才可以攻打下一关。

  ### 5.能够正确判断战斗胜负，战胜后会给予一定的资源奖励
  - 如果资源数量增加后超出上限，则弹窗中提示信息，资源已满，多余的资源不被获取
  - 如果此时士兵数量已为0，地图仍未被攻打结束，则跳出失败弹窗

  ### 6.本地存档
  - 在Helloworld界面提供两种登录方式，可以本地登录，在游戏中通过存档按钮实现本地存档，下次可以继续此游戏，资源和战斗相关数据保留。
    
  ### 7.PVP模式
  - 基本架构：使用Myserver中Server.py文件在作为服务器的电脑上的cmd窗口中运行开启终端，终端可以看到各个账号的登录情况、界面编辑过程等等，可以对账号进行统一管理
  - 功能使用：在Helloworld界面也可以用账号登录，连接到服务器。自动判断此账号是否被注册过。若为新账号，则开始新游戏；若为已注册账号，则登录。登录后可以攻打此前已经创建过账号的营地。随着营地的升级建筑的生命值有所提高。攻打成功同样也会获得一定数量的资源。


  ## 项目开发日志
  ### 12-01

  - 搜集游戏图片素材
  - 项目初步分工

  ### 12-02
  - 实现最基础的GameScene、Building类及BuildinginfoLayer类，以大本营为例初步实现建筑的放置和属性弹窗升级功能
  - 修改游戏窗口大小

  ### 12-03
  - 第一关地图的第一次绘制尝试
  - 地图加载相关类的基础功能 BattleScene、EnemyBuilding
  - 上传了一部分相关资源

  ### 12-04

  - 上传了一部分相关资源
  - 初步实现战斗的最基础逻辑
  - 在GameScene类中实现了资源栏以及ui相关设施，将升级与资源的变化进行初步的捆绑

  ### 12-05

  - 换用Tiled进行主界面、关卡地图的绘制
  - 绘制主界面地图，并将建筑类更加统一化规格化方便不同建筑的放置
  - 初步实现商店界面ShopScene类，能够购买基础的几种建筑

  ### 12-06~12-07

  - 选定四个基础兵种的形象
  - 实现兵营中训练士兵的功能TrainingLayer，可以自由增减，实现兵营升级逻辑，增添DataManager类管理兵营数据
  - 初步实现主界面建筑的拖拽功能
  - 完善建筑升级的功能，增添倒计时和宝石加速功能
  - 实现士兵基类Soldier，派生类GiantSoldier，基本完成第一张地图，实现防御塔的攻击，士兵攻击及血条的变化
  - 实现商城购买后的落地功能，修复了从商城/战斗场景后回到主场景，主场景建筑会一键初始化的bug
  - 调整了一部分图片资源的尺寸

  ### 12-08

  - 商店增加军营，金币，水储存器
  - 增加金矿、水收集器的收集金币和水的功能
  - 完善战斗场景，修复防御塔血量清零后仍能攻击的bug
  - 增加判定战斗成功逻辑，添加基础的战斗成功的弹窗

  ### 12-09

  - 实现从训练士兵的页面跳转到关卡地图进行攻击，实现派兵的按钮与功能
  - 实现剩余三种基础兵种的派生类OriginalSoldier、BoomSoldier、ArrowSoldier

  ### 12-10

  - 初步实现存档功能
  - 完善关卡地图的攻击画面与相关逻辑

  ### 12-11

  - 增加第二章地图，实现第二关
  - 添加主界面建筑之间的碰撞检测功能
  - 添加商店购买的新建筑自动检测空闲位置放置的逻辑
  - 进一步完善存档功能

  ### 12-15

  - 优化战斗胜利弹窗，增添战斗胜利的奖励
  - 添加主场景和战斗场景的音乐

  - 优化主界面地图，实现了主界面的放大缩小拖拽功能，建筑的放置有一定的范围，优化建筑的放置
  - 修复炸弹人相关的野指针导致的闪退bug

  ### 12-18

  - 进一步优化存档功能

  ### 12-19

  - 增加判定战斗失败逻辑，添加基础的战斗失败的弹窗

  - 增加第三张地图，增加栅栏提升关卡难度，增加加农炮攻击
  - 优化士兵对于栅栏的攻击逻辑
  - 优化战斗结束的场景

  ### 12-21

  - 增加天空兵种派生类AirForceSoldier

  - 增加建筑之间的升级制约
  - 优化资源溢出时的逻辑，消失给出提示

  - 进一步优化读档功能

  ### 12-22

  - 增加第四张地图，地图中存在炸弹陷阱

  - 修复存档功能中存在的bug
  - 实现金矿和圣水收集可以升级又可以生产
  - 统一关卡建筑和营地建筑属性
  - 建立初步的网络端口

  ### 12-23

  - 实现并优化初步的后端服务器功能

  - 实现Helloworld界面的账号登录功能
  - 本地存档功能依旧保留

  ### 12-24

  - 进一步优化后端服务器功能

  - 实现账号之间互相访问的功能，并能够回到自己的营地
  - 修复各建筑功能出现的bug
  - 优化三四关地图的士兵投放区域

  ### 12-25

  - 进一步优化后端服务器功能

  - 实现账号之间互相访问的功能，并能够回到自己的营地
  - 修复各建筑功能出现的bug
  - 保留本地创建新游戏和继续游戏功能，方便游戏测试
  - 初步实现账号之间互相攻击的PVP模式

  ### 12-26

  - 完善账号访问列表的界面
  - 彻底优化完善PVP模式
  - 修复各种读档、PVP与单机模式不兼容，攻击好友时出现的各类bug
    
   ### 12-27~12-28

  - 不断优化代码结构，删除之前的冗余部分
  - 测试游戏各功能各场景出现的bug，发现并解决

## 感谢阅读观看！
